<!DOCTYPE html>
<html>
    <head>
        <style>
            table {
                border-collapse: collapse;
                width: 100%;
                text-align: center;
            }

            table,
            th,
            td {
                border: 1px solid black;
            }

            th,
            td {
                padding: 10px;
            }
        </style>
    </head>
    <body>
        <label>
            <input
                type="radio"
                name="role"
                onchange="updatePlaceholder('t')"
                value="teacher"
            />
            Teacher
        </label>
        <label>
            <input
                type="radio"
                name="role"
                onchange="updatePlaceholder('s')"
                value="student"
                checked
            />
            Student
        </label>
        <input type="text" id="data" placeholder="Enter batch" />
        <button onclick="handleSubmit()">Submit</button>
        <a href="room-slot-view.html">Room Allocation</a>
        <div id="class-routine"></div>

        <script>
            var jsonData;
            var query = "";
            const url = "./data.php?";
            const input = document.getElementById("data");
            const routineTable = document.getElementById("class-routine");

            function updatePlaceholder(x) {
                input.value = "";
                if (x == "t") input.placeholder = "Enter Initial";
                else input.placeholder = "Enter batch no";
            }

            function handleSubmit() {
                const selectedRole = document.querySelector(
                    'input[name="role"]:checked'
                );

                if (selectedRole.value == "teacher")
                    query = url + "teacher=" + input.value;
                else query = url + "batch=" + input.value;

                console.log(query);
                fetch(query)
                    .then((response) => response.json())
                    .then((jsonData) => {
                        document.getElementById("class-routine").innerHTML =
                            createTable(jsonData);
                    });
            }

            function createTableRow(day, slots) {
                let row = "<tr><td>" + day + "</td>";
                for (let i = 1; i <= 9; i++) {
                    let courses = slots.filter((slot) => slot.slot == i); 
                    if (courses.length > 0) {
                        row += "<td>";
                        courses.forEach((course, index) => {
                            row +=
                                course.course +
                                "<br>" +
                                course.teacher +
                                "<br>Room " +
                                course.room +
                                "<br>Batch " +
                                course.batch +
                                "";
                            if (index < courses.length - 1) {
                                row += "<hr>";
                            }
                        });
                        row += "</td>";
                    } else {
                        row += "<td></td>";
                    }
                }
                row += "</tr>";
                return row;
            }

            function groupByDay(dataArray) {
                let groupedData = {};
                dataArray.forEach((course) => {
                    if (!groupedData.hasOwnProperty(course.day)) {
                        groupedData[course.day] = [];
                    }
                    groupedData[course.day].push(course);
                });
                return groupedData;
            }

            function createTable(dataArray) {
                const groupedData = groupByDay(dataArray);
                let table =
                    "<table><thead><tr><th>Days/Slots</th><th>Slot 1</th><th>Slot 2</th><th>Slot 3</th><th>Slot 4</th><th>Slot 5</th><th>Slot 6</th><th>Slot 7</th><th>Slot 8</th><th>Slot 9</th></tr></thead><tbody>";

                for (const [day, slots] of Object.entries(groupedData)) {
                    table += createTableRow(day, slots);
                }

                table += "</tbody></table>";
                return table;
            }
        </script>
    </body>
</html>
